<!--
Load the web component libraries
-->
<link href="./cube-element-import.html" rel="import">

<link href="../polymer/polymer.html" rel="import">

<!--
Main element code
-->
<polymer-element
    name="cube-element"
    attributes="height width initmove initrevmove demo">
    <template>
        <link rel="stylesheet" type="text/css" href="./styles/cube.css">
        <link rel="stylesheet" type="text/css" href="./styles/base.css">

        <style>
            #cubeContainer {
                height: {{ height }};
                width:  {{ width }};
            }
        </style>

        <div id="cubeContainer">
        </div>
    
    </template>
    <script>
        Polymer('cube-element', {
            // parameters
            height: "300px",
            width:  "300px",

            // callback
            ready: function(){

                var useLockedControls = true,
                    controls = useLockedControls ? ERNO.Locked : ERNO.Freeform;
                var ua = navigator.userAgent,
                    isIe = ua.indexOf('MSIE') > -1 || ua.indexOf('Trident/') > -1;

                var cube = new ERNO.Cube({
                    hideInvisibleFaces: false,
                    controls: controls,
                    renderer: isIe ? ERNO.renderers.IeCSS3D : null
                });

                this.$.cubeContainer.appendChild( cube.domElement );

                if( controls === ERNO.Locked ){
                    var fixedOrientation = new THREE.Euler(  Math.PI * 0.1, Math.PI * -0.25, 0 );
                    cube.object3D.lookAt( cube.camera.position );
                    cube.rotation.x += fixedOrientation.x;
                    cube.rotation.y += fixedOrientation.y;
                    cube.rotation.z += fixedOrientation.z;
                }
                
                // calculate the algo to revert cube
                var reverseTwist = this.demo.reverse().invert();


                // TODO: facelets

                // TODO: initrevmove, initmove
                for ( var i = 0 ; i < reverseTwist.length ; i++ ) {
                    var step = reverseTwist[i]
                    var stepTwist = new ERNO.Twist(step);

                    cube.immediateTwist(stepTwist);
                }

                // demo

                var _this = this;
                setTimout(1000, function () {cube.twist(_this.demo);});

            }
        });
    
    </script>
</polymer-element>
